<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>StakeWatch – Übersicht</title>

  <style>
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      margin: 20px;
    }
    h1 {
      margin-bottom: 5px;
    }
    .info {
      color: #555;
      font-size: 14px;
      margin-bottom: 15px;
    }
    .controls {
      margin-bottom: 15px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    select, input, button {
      padding: 8px 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 14px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
    }
    th, td {
      border-bottom: 1px solid #eee;
      padding: 10px;
      text-align: left;
      vertical-align: top;
    }
    th {
      background: #fafafa;
      position: sticky;
      top: 0;
    }
    .badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 12px;
      border: 1px solid #ccc;
      background: #f5f5f5;
    }
    a {
      word-break: break-all;
    }
  </style>
</head>

<body>

<h1>StakeWatch</h1>
<div class="info">
  Automatische Übersicht über neue SEC-Meldungen<br>
  <strong>SC 13D</strong> = oft strategische Beteiligung &gt; 5 %<br>
  <strong>SC 13G</strong> = meist passive Beteiligung &gt; 5 %<br>
  <strong>8-K</strong> = wichtige Unternehmensmeldung (z. B. Verträge, M&A)
</div>

<div class="controls">
  <select id="formFilter">
    <option value="">Alle Typen</option>
    <option value="SC 13D">SC 13D</option>
    <option value="SC 13G">SC 13G</option>
    <option value="8-K">8-K</option>
  </select>

  <input id="search" placeholder="Firma oder Text suchen …" size="30">

  <button onclick="reload()">Neu laden</button>
</div>

<table>
  <thead>
    <tr>
      <th>Zeit (UTC)</th>
      <th>Typ</th>
      <th>Titel</th>
      <th>Original-Link</th>
    </tr>
  </thead>
  <tbody id="tableBody"></tbody>
</table>

<script>
let allData = [];

async function loadData() {
  const response = await fetch("data.json?x=" + Date.now());
  allData = await response.json();
  render();
}

function render() {
  const filter = document.getElementById("formFilter").value;
  const search = document.getElementById("search").value.toLowerCase();
  const body = document.getElementById("tableBody");
  body.innerHTML = "";

  allData.forEach(item => {
    if (filter && item.form !== filter) return;
    if (search && !item.title.toLowerCase().includes(search)) return;

    const row = document.createElement("tr");

    row.innerHTML = `
      <td>${item.time_utc}</td>
      <td><span class="badge">${item.form}</span></td>
      <td>${item.title}</td>
      <td><a href="${item.link}" target="_blank">SEC-Dokument öffnen</a></td>
    `;
    body.appendChild(row);
  });
}

function reload() {
  loadData();
}

document.getElementById("formFilter").onchange = render;
document.getElementById("search").oninput = render;

loadData();
</script>

</body>
</html>
